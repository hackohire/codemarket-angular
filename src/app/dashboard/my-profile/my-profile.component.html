<div *ngIf="userData$ | async as user">
	<!-- <app-breadcumb [title]="user?.name" [path]="breadcumb?.path"></app-breadcumb>  -->


	<section style="padding-top: 35px;" class="author-profile-area">
		<div class="container" style="margin: auto;">
			<div class="container" style="margin-top: 0; margin-bottom: 15px;">

				<div class="row">
					<div class="col-lg-3 col-md-3 col-sm-3 align-items-center justify-content-center"
						style="margin: auto;">
						<div class="profile-picture">
							<div class="user-info">
								<div class="profile-pic">
									<img
										[src]="selectedProfilePicURL ? (selectedProfilePicURL | safe: 'resourceUrl') : user?.avatar ? ((s3FilesBucketURL + user?.avatar) | safe: 'resourceUrl') : anonymousAvatar" />
									<div class="layer">
										<div class="loader"></div>
									</div>
									<a class="image-wrapper">
										<mat-icon class="edit glyphicon glyphicon-pencil" (click)="addProfilePic()">edit
										</mat-icon>
										<mat-icon class="edit glyphicon glyphicon-pencil"
											(click)="removeProfilePic(user?._id)">delete</mat-icon>
									</a>
								</div>
							</div>
							<input type="file" #profilePic style="display: none" (change)="onProfilePicAdded()" />
						</div>
						<div style="display: flex;">
							<button *ngIf="selectedProfilePic" style="margin: auto;" type="button"
								class="btn btn--vsm btn--round"
								(click)="updateProfilePicture(user?._id)">Update</button>
						</div>
						<h4 style="text-align: center; padding-top: 10px;">{{user?.name}}</h4>
					</div>
					<div class="col-lg-9 col-md-9 col-sm-9" style="padding: 0;">
						<div class="picture-container" *ngIf="selectedCoverPic?.name || user?.cover">

							<img #cover
								[src]="selectedCoverPic ? (selectedCoverPicURL | safe: 'resourceUrl') : ((s3FilesBucketURL + user?.cover) | safe: 'resourceUrl')">

							<div class="controls" *ngIf="user?._id === authService?.loggedInUser?._id">
								<a mat-button style="background-color: #ff00007a;" (click)="removeCover(user?._id);"
									class="save">Remove</a>
								<a mat-button style="background-color: #0674ec" *ngIf="!user?.cover"
									(click)="updateCover(user?._id)" class="save">Upload
									Cover</a>
							</div>

						</div>
						<div class="image-upload-wrap" style="height: 300px;"
							*ngIf="user?._id === authService?.loggedInUser?._id && !selectedCoverPic && !user?.cover">
							<input #coverPic class="file-upload-input" type='file' (change)="onFilesAdded()"
								accept="image/*" />
							<div class="drag-text">
								<h3>Drag and drop a file or select add Image 685w x 300h</h3>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="row">

				<!-- start aside -->
				<div class="col-md-3">
					<!-- <app-add-post-menu style="color: #0674ec !important; margin-left: auto;">
					</app-add-post-menu> -->
					<div class="docs-component-viewer-nav common-box-shadow"
						style="margin-bottom: 20px; margin-top: 10px;">
						<div class="docs-component-viewer-nav-content">
							<div *ngFor="let category of profileViewLinks; let last = last;">
								<button cdkAccordionItem #panel="cdkAccordionItem"
									[expanded]="category?.types ? isExpanded(category) : false"
									(click)="selectMainCategory(category, panel)" class="docs-nav-content-btn"
									[ngClass]="profileView === category.view ? 'docs-component-viewer-sidenav-item-selected' : ''"
									[attr.aria-controls]="'panel-' + category.view"
									[attr.aria-expanded]="panel.expanded">
									{{category.title}}
									<mat-icon *ngIf="category?.types">
										{{panel.expanded ? 'keyboard_arrow_up' :  'keyboard_arrow_down'}}
									</mat-icon>
								</button>
								<mat-nav-list dense [@bodyExpansion]="panel.expanded ? 'expanded' : 'collapsed'"
									id="panel-{{category.view}}" [attr.aria-label]="category.view">
									<a mat-list-item *ngFor="let component of category?.types"
										(click)="selectMainCategory(component, panel)"
										[ngClass]="component.view === profileView ? 'docs-component-viewer-sidenav-item-selected': ''"
										[attr.aria-current]="profileView === component.view ? 'page': 'false'">
										{{component.title}}
									</a>
								</mat-nav-list>
								<hr *ngIf="!last" />
							</div>

							<!-- Based On the List Of Post Types -->
							<div *ngFor="let p of postTypesArray; let last = last;">
								<button cdkAccordionItem
									[routerLink]="[]"
									[queryParams]="{ view: p.name }"
									[queryParamsHandling]="'merge'"
									(click)="profileView = p.name; fetchAllOtherPosts(p.name);"
									class="docs-nav-content-btn"
									[ngClass]="profileView === p.name ? 'docs-component-viewer-sidenav-item-selected' : ''">
									{{p.name}}
								</button>
								<hr *ngIf="!last" />
							</div>
						</div>
					</div>
				</div>

				<div class="col-lg-9 col-md-9">

					<div class="row">
						<div class="col-md-12">

							<!-- POST EDITOR STARTS HERE -->
							<div class="comment-form-area" style="padding: 0;">
								<div class="media comment-form">
									<div class="media-left">
										<a [routerLink]="['/', 'dashboard', 'profile', authService?.loggedInUser?._id ]">
											<img class="author_avatar_comment" style="height: 45px; width:45px;"
												[src]="authService?.loggedInUser?.avatar ? ((s3FilesBucketURL + authService?.loggedInUser?.avatar) | safe: 'resourceUrl') : anonymousAvatar"
												alt="Commentator Avatar">
										</a>
									</div>
									<div class="media-body">
										<div class="comment-reply-form">
											<app-add-post-menu #addPostMenu
												style="position: absolute; visibility: hidden;">
											</app-add-post-menu>
											<div (click)="addPostMenu.openMenu();" class="comment-reply-form">
												<textarea placeholder="Add Post!"
													style="background: white; height: 100px; padding: 20px 35px; width: 100%; min-height: 130px; border-radius: 6px;"></textarea>

												<button style="float: right; margin-top: 10px; margin-bottom: 20px;"
													type="button" class="btn btn--sm btn--round"
													(click)="addPostMenu.openMenu();">Post</button>
											</div>
										</div>
									</div>
								</div>
							</div>
							<!-- POST EDITOR ENDS HERE -->

							<div *ngIf="profileView === navLinkName.buy">
								<router-outlet></router-outlet>
							</div>

							<div *ngIf="profileView === navLinkName.sell">
								<router-outlet></router-outlet>
							</div>

							<div *ngIf="profileView === navLinkName.membership">
								<router-outlet></router-outlet>
							</div>

							<div *ngIf="profileView === navLinkName.myrsvp">
								<router-outlet></router-outlet>
							</div>

							<!-- Showing the list of posts for the posts tab, everytime user clicks on the "load more", we increase the page number and call
							fetchAllOtherPosts method to fetch subsequent posts -->
							<ng-container *ngIf="profileView === navLinkName.posts">
								<div class="item-grid pen-grid item-grid-large">
									<app-brief-post style="width: 100%;" [p]="e" *ngFor="let e of listOfAllOtherPosts?.posts" [readMore]="true"></app-brief-post>
								</div>
								<app-paginator [length]="totalOtherPosts" (fetchData)="paginator = $event; fetchAllOtherPosts()">
								</app-paginator>
							</ng-container>

							<!-- Show list of the posts based on post type -->
							<ng-container *ngFor="let p of postTypesArray">
								<ng-container *ngIf="profileView === p.name">
									<div class="item-grid pen-grid item-grid-large">
										<app-brief-post style="width: 100%;" [p]="e"
											*ngFor="let e of listOfAllOtherPosts?.posts" [readMore]="true"></app-brief-post>
									</div>
									<app-paginator [length]="totalOtherPosts" (fetchData)="paginator = $event; fetchAllOtherPosts(p.name)">
									</app-paginator>
								</ng-container>
							</ng-container>

							<div *ngIf="profileView === navLinkName?.info && (userData$) | async as user">
								<div class="col-lg-12 col-md-12">
									<aside class="common-box-shadow sidebar sidebar_author">
										<div class="author-card sidebar-card">
											<div class="author-infos">
												<div class="author_avatar">
													<img [src]="user?.avatar ? ((s3FilesBucketURL + user.avatar) | safe: 'resourceUrl') : anonymousAvatar"
														alt="Presenting the broken author avatar :D">
												</div>

												<div class="author">
													<h4>{{user?.name}}</h4>
													<button
														*ngIf="authorId && authService?.loggedInUser?._id && authService?.loggedInUser?._id !== authorId"
														(click)="openDialog()" mat-mini-fab color="primary">
														<mat-icon>video_call</mat-icon>
													</button>
													<p>On platform since {{user?.createdAt | date}}</p>
												</div>
												<!-- end /.author -->


												<div class="social social--color--filled">
													<ul>
														<li style="margin: 5px; color: initial">
															<a [href]="user?.linkedin_url">
																<i style="font-size: 1.7rem !important;"
																	class="fab fa-linkedin"></i>
															</a>
														</li>
														<li style="margin: 5px">
															<a [href]="user?.github_url">
																<i style="font-size: 1.7rem !important;"
																	class="fab fa-stack-overflow"></i>
															</a>
														</li>
														<li style="margin: 5px">
															<a [href]="user?.stackoverflow_url">
																<i style="font-size: 1.7rem !important;"
																	class="fab fa-github"></i>
															</a>
														</li>
													</ul>
												</div>



												<ul class="infos">
													<li>
														<span class="data-label">Likes: </span>
														<span class="info"
															*ngIf="authService?.loggedInUser; else likeCount">
															<app-like-dislike [data]="user" [type]="'user'"
																[likeCount]="null">
															</app-like-dislike>
														</span>
														<ng-template #likeCount>
															<div class="info">
																{{user?.likeCount}}
															</div>
														</ng-template>
													</li>
												</ul>
												<!-- end /.social -->

												<!-- <div class="author-btn">
																				<a href="#" class="btn btn--md btn--round">Follow</a>
																		</div> -->
												<!-- end /.author-btn -->
											</div>
											<!-- end /.author-infos -->
										</div>
										<!-- end /.author-card -->
									</aside>
								</div>
							</div>

						</div>
					</div>
				</div>
			</div>


		</div>

	</section>
</div>