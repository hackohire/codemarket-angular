<div *ngIf="!readOnly" class="ce-toolbox ce-toolbox--opened" style="position: relative;">
    <li class="ce-toolbox__button" data-tool="paragraph"
    (click)="insertNewBlock('paragraph')">
    <svg xmlns="http://www.w3.org/2000/svg"
            viewBox="0.2 -0.3 9 11.4" width="12" height="14">
            <path
                d="M0 2.77V.92A1 1 0 01.2.28C.35.1.56 0 .83 0h7.66c.28.01.48.1.63.28.14.17.21.38.21.64v1.85c0 .26-.08.48-.23.66-.15.17-.37.26-.66.26-.28 0-.5-.09-.64-.26a1 1 0 01-.21-.66V1.69H5.6v7.58h.5c.25 0 .45.08.6.23.17.16.25.35.25.6s-.08.45-.24.6a.87.87 0 01-.62.22H3.21a.87.87 0 01-.61-.22.78.78 0 01-.24-.6c0-.25.08-.44.24-.6a.85.85 0 01.61-.23h.5V1.7H1.73v1.08c0 .26-.08.48-.23.66-.15.17-.37.26-.66.26-.28 0-.5-.09-.64-.26A1 1 0 010 2.77z">
            </path>
        </svg>
    </li>
    <li class="ce-toolbox__button" data-tool="header"
    (click)="insertNewBlock('header')"><svg width="10" height="14" xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 10 14">
            <path
                d="M7.6 8.15H2.25v4.525a1.125 1.125 0 0 1-2.25 0V1.125a1.125 1.125 0 1 1 2.25 0V5.9H7.6V1.125a1.125 1.125 0 0 1 2.25 0v11.55a1.125 1.125 0 0 1-2.25 0V8.15z">
            </path>
        </svg>
    </li>
    <li class="ce-toolbox__button" data-tool="delimiter" (click)="insertNewBlock('delimiter')"><svg width="19" height="4" viewBox="0 0 19 4"
            xmlns="http://www.w3.org/2000/svg">
            <path
                d="M1.25 0H7a1.25 1.25 0 1 1 0 2.5H1.25a1.25 1.25 0 1 1 0-2.5zM11 0h5.75a1.25 1.25 0 0 1 0 2.5H11A1.25 1.25 0 0 1 11 0z">
            </path>
        </svg></li>
    <li class="ce-toolbox__button" data-tool="linkTool" (click)="insertNewBlock('linkTool')"><svg width="13" height="14" xmlns="http://www.w3.org/2000/svg">
            <path
                d="M8.567 13.629c.728.464 1.581.65 2.41.558l-.873.873A3.722 3.722 0 1 1 4.84 9.794L6.694 7.94a3.722 3.722 0 0 1 5.256-.008L10.484 9.4a5.209 5.209 0 0 1-.017.016 1.625 1.625 0 0 0-2.29.009l-1.854 1.854a1.626 1.626 0 0 0 2.244 2.35zm2.766-7.358a3.722 3.722 0 0 0-2.41-.558l.873-.873a3.722 3.722 0 1 1 5.264 5.266l-1.854 1.854a3.722 3.722 0 0 1-5.256.008L9.416 10.5a5.2 5.2 0 0 1 .017-.016 1.625 1.625 0 0 0 2.29-.009l1.854-1.854a1.626 1.626 0 0 0-2.244-2.35z"
                transform="translate(-3.667 -2.7)"></path>
        </svg></li>
    <li class="ce-toolbox__button" data-tool="table" (click)="insertNewBlock('table')"><svg width="18" height="14">
            <path
                d="M2.833 8v1.95a1.7 1.7 0 0 0 1.7 1.7h3.45V8h-5.15zm0-2h5.15V2.35h-3.45a1.7 1.7 0 0 0-1.7 1.7V6zm12.3 2h-5.15v3.65h3.45a1.7 1.7 0 0 0 1.7-1.7V8zm0-2V4.05a1.7 1.7 0 0 0-1.7-1.7h-3.45V6h5.15zM4.533.1h8.9a3.95 3.95 0 0 1 3.95 3.95v5.9a3.95 3.95 0 0 1-3.95 3.95h-8.9a3.95 3.95 0 0 1-3.95-3.95v-5.9A3.95 3.95 0 0 1 4.533.1z">
            </path>
        </svg></li>
    <li class="ce-toolbox__button" data-tool="list" (click)="insertNewBlock('list')"><svg width="17" height="13" viewBox="0 0 17 13"
            xmlns="http://www.w3.org/2000/svg">
            <path
                d="M5.625 4.85h9.25a1.125 1.125 0 0 1 0 2.25h-9.25a1.125 1.125 0 0 1 0-2.25zm0-4.85h9.25a1.125 1.125 0 0 1 0 2.25h-9.25a1.125 1.125 0 0 1 0-2.25zm0 9.85h9.25a1.125 1.125 0 0 1 0 2.25h-9.25a1.125 1.125 0 0 1 0-2.25zm-4.5-5a1.125 1.125 0 1 1 0 2.25 1.125 1.125 0 0 1 0-2.25zm0-4.85a1.125 1.125 0 1 1 0 2.25 1.125 1.125 0 0 1 0-2.25zm0 9.85a1.125 1.125 0 1 1 0 2.25 1.125 1.125 0 0 1 0-2.25z">
            </path>
        </svg></li>
    <li class="ce-toolbox__button" data-tool="image" (click)="insertNewBlock('image')"><svg width="17" height="15" viewBox="0 0 336 276"
            xmlns="http://www.w3.org/2000/svg">
            <path
                d="M291 150.242V79c0-18.778-15.222-34-34-34H79c-18.778 0-34 15.222-34 34v42.264l67.179-44.192 80.398 71.614 56.686-29.14L291 150.242zm-.345 51.622l-42.3-30.246-56.3 29.884-80.773-66.925L45 174.187V197c0 18.778 15.222 34 34 34h178c17.126 0 31.295-12.663 33.655-29.136zM79 0h178c43.63 0 79 35.37 79 79v118c0 43.63-35.37 79-79 79H79c-43.63 0-79-35.37-79-79V79C0 35.37 35.37 0 79 0z">
            </path>
        </svg></li>
    <li class="ce-toolbox__button" data-tool="code" (click)="insertNewBlock('code')"><svg width="14" height="14" viewBox="0 -1 14 14"
            xmlns="http://www.w3.org/2000/svg">
            <path
                d="M3.177 6.852c.205.253.347.572.427.954.078.372.117.844.117 1.417 0 .418.01.725.03.92.02.18.057.314.107.396.046.075.093.117.14.134.075.027.218.056.42.083a.855.855 0 0 1 .56.297c.145.167.215.38.215.636 0 .612-.432.934-1.216.934-.457 0-.87-.087-1.233-.262a1.995 1.995 0 0 1-.853-.751 2.09 2.09 0 0 1-.305-1.097c-.014-.648-.029-1.168-.043-1.56-.013-.383-.034-.631-.06-.733-.064-.263-.158-.455-.276-.578a2.163 2.163 0 0 0-.505-.376c-.238-.134-.41-.256-.519-.371C.058 6.76 0 6.567 0 6.315c0-.37.166-.657.493-.846.329-.186.56-.342.693-.466a.942.942 0 0 0 .26-.447c.056-.2.088-.42.097-.658.01-.25.024-.85.043-1.802.015-.629.239-1.14.672-1.522C2.691.19 3.268 0 3.977 0c.783 0 1.216.317 1.216.921 0 .264-.069.48-.211.643a.858.858 0 0 1-.563.29c-.249.03-.417.076-.498.126-.062.04-.112.134-.139.291-.031.187-.052.562-.061 1.119a8.828 8.828 0 0 1-.112 1.378 2.24 2.24 0 0 1-.404.963c-.159.212-.373.406-.64.583.25.163.454.342.612.538zm7.34 0c.157-.196.362-.375.612-.538a2.544 2.544 0 0 1-.641-.583 2.24 2.24 0 0 1-.404-.963 8.828 8.828 0 0 1-.112-1.378c-.009-.557-.03-.932-.061-1.119-.027-.157-.077-.251-.14-.29-.08-.051-.248-.096-.496-.127a.858.858 0 0 1-.564-.29C8.57 1.401 8.5 1.185 8.5.921 8.5.317 8.933 0 9.716 0c.71 0 1.286.19 1.72.574.432.382.656.893.671 1.522.02.952.033 1.553.043 1.802.009.238.041.458.097.658a.942.942 0 0 0 .26.447c.133.124.364.28.693.466a.926.926 0 0 1 .493.846c0 .252-.058.446-.183.58-.109.115-.281.237-.52.371-.21.118-.377.244-.504.376-.118.123-.212.315-.277.578-.025.102-.045.35-.06.733-.013.392-.027.912-.042 1.56a2.09 2.09 0 0 1-.305 1.097c-.2.323-.486.574-.853.75a2.811 2.811 0 0 1-1.233.263c-.784 0-1.216-.322-1.216-.934 0-.256.07-.47.214-.636a.855.855 0 0 1 .562-.297c.201-.027.344-.056.418-.083.048-.017.096-.06.14-.134a.996.996 0 0 0 .107-.396c.02-.195.031-.502.031-.92 0-.573.039-1.045.117-1.417.08-.382.222-.701.427-.954z">
            </path>
        </svg></li>
</div>

<div *ngIf="!readOnly && isPlatformBrowser" #editorRef [ngStyle]="editorStyle" [id]="id"></div>

<div #editorViewRef [ngStyle]="editorStyle" [ngClass]="readOnly ? '' : 'visibility-hidden'">
    <div class="ce-block">
        <div class="ce-block__content" style="word-break: break-all">
            <ng-container [ngSwitch]="b?.type" *ngFor="let b of data; let i = index">
                <div fxLayout="row" fxLayoutGap="5px" fxLayoutAlign="start center">
                    <div [fxFlex]="blockLevelComments ? '90' : '100'">
                        <!-- Paragraph -->
                        <div *ngSwitchCase="'paragraph'">
                            <div class="ce-paragraph cdx-block" [innerHTML]="b?.data?.text">
                            </div>
                        </div>

                        <!-- List -->
                        <div *ngSwitchCase="'list'">
                            <ul [ngClass]="['cdx-block', 'cdx-list', 'cdx-list--' + b?.data?.style]">
                                <li class="cdx-list__item" *ngFor="let i of b?.data?.items" [innerHTML]="i"></li>
                            </ul>
                        </div>

                        <!-- Header -->
                        <div style="height: fit-content;" *ngSwitchCase="'header'"
                            innerHTML="{{'<h' + b?.data?.level + ' class=ce-header' + '>' + b?.data?.text + '</h' + b?.data?.level + '>'}}">
                            <!-- <div>
                            </div> -->
                        </div>

                        <!-- Image / Video -->
                        <div *ngSwitchCase="'image'">
                            <div class="cdx-block image-tool image-tool--filled" *ngIf="b?.data?.file?.url">
                                <div class="image-tool__image">
                                    <ng-container *ngIf="isImage(b?.data?.file?.url); else elseTemplate">
                                        <img (click)="zoomInOut($event)" class="image-tool__image-picture"
                                            [src]="b?.data?.file?.url | safe: 'url'">
                                        <div style="text-align: center; margin-top: 5px;"
                                            [innerHTML]="b?.data?.caption"></div>
                                    </ng-container>

                                    <ng-template #elseTemplate>
                                        <video class="image-tool__image-picture" autoplay loop controls
                                            [src]="b?.data?.file?.url | safe: 'url'"></video>
                                        <div style="text-align: center; margin-top: 5px;"
                                            [innerHTML]="b?.data?.caption"></div>
                                    </ng-template>
                                </div>
                            </div>
                        </div>

                        <!-- Embed -->
                        <div *ngSwitchCase="'embed'">
                            <div class="cdx-block embed-tool">
                                <iframe *ngIf="b?.data?.service !== 'github'; else gistTemplate" scrolling="no"
                                    class="embed-tool__content" style="width:100%;" frameborder="0" height="400px"
                                    allowfullscreen [src]="b?.data?.embed | safe : 'resourceUrl'"></iframe>
                                <!-- When there is Gist -->
                                <ng-template #gistTemplate>
                                    <iframe scrolling="no" width="100%" frameborder="0" height="350px" allowfullscreen
                                        [srcdoc]="gistFrame(b?.data?.embed) | safe: 'html'">
                                    </iframe>
                                </ng-template>
                                <div style="text-align: center; margin-top: 5px;" [innerHTML]="b?.data?.caption"></div>
                            </div>
                        </div>

                        <div *ngSwitchCase="'linkTool'" class="link-tool">
                            <a class="link-tool__content link-tool__content--rendered" target="_blank"
                                rel="nofollow noindex noreferrer" [href]="b?.data?.link">
                                <div *ngIf="b?.data?.meta?.image?.url" class="link-tool__image"
                                    [ngStyle]="{'background-image': 'url(' + b?.data?.meta?.image?.url + ')', 'display': 'block'}">
                                </div>
                                <div class="link-tool__title">{{b?.data?.meta?.title}}</div>
                                <p class="link-tool__description">
                                    {{b?.data?.meta?.title}}
                                </p><span class="link-tool__anchor">{{b?.data?.meta?.domain}}</span>
                            </a></div>

                        <!-- Code -->
                        <div *ngSwitchCase="'code'">
                            <div class="cdx-block ce-code"><span
                                    style="text-align: right; margin-bottom: 5px;">{{b?.data?.language}}</span>
                                <pre><code [innerText]="b?.data?.code"></code></pre>
                            </div>
                        </div>

                        <!-- Table -->
                        <div *ngSwitchCase="'table'">
                            <div class="tc-editor cdx-block">
                                <div class="tc-table__wrap">
                                    <table class="tc-table">
                                        <tbody>
                                            <tr *ngFor="let r of b?.data?.content; let ri = index;">
                                                <td class="tc-table__cell" *ngFor="let c of r; let ci = index;">
                                                    <div class="tc-table__area">
                                                        <div class="tc-table__inp" contenteditable="false"
                                                            [innerHTML]="b?.data?.content[ri][ci]"></div>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <div *ngSwitchCase="'delimiter'">
                            <div class="ce-delimiter cdx-block"></div>
                        </div>
                    </div>


                    <!-- Icon to view / collapse comments section -->
                    <div [fxFlex]="blockLevelComments ? '10' : '0'">
                        <ng-container *ngIf="blockLevelComments">
                            <a style="text-align: right; padding: 0 8px; text-decoration: none;" *ngIf="!b['__show']"
                                mat-button (click)="b['__show'] = true">
                                <i [style.color]=" commentsList && commentsList?.length && numberOfComments(b?._id) > 0 ? '#0674ec' : ''"
                                    style="font-size: 1.3rem !important; font-style: normal;"
                                    class="fad fa-comments-alt fa-lg"></i>
                                <span>{{' ('}} {{ commentsList && commentsList?.length ? numberOfComments(b?._id) : 0}}
                                    {{')'}}</span>
                            </a>
                            <a style="padding: 0 8px; text-decoration: none;" *ngIf="b['__show']" mat-button
                                (click)="b['__show'] = false">
                                <i [style.color]="commentsList && commentsList?.length && numberOfComments(b?._id) > 0 ? '#0674ec' : ''"
                                    style="font-size: 1.3rem !important; font-style: normal;"
                                    class="fad fa-chevron-circle-up fa-lg"></i>
                                <span>{{' ('}} {{ commentsList && commentsList?.length ? numberOfComments(b?._id) : 0}}
                                    {{')'}}</span>
                            </a>
                        </ng-container>
                    </div>
                </div>

                <!-- Common Add Comment Template -->
                <div *ngIf="blockLevelComments && b['__show']">
                    <ng-container *ngTemplateOutlet="addCommentTemplate; context: {blockId: b?._id}"></ng-container>
                </div>
            </ng-container>
        </div>
    </div>

    <!-- <pre>{{data | json}}</pre> -->
</div>

<ng-template #addCommentTemplate let-cDetails="details" let-blockId="blockId">
    <!-- {{blockId}} -->
    <!-- {{cDetails | json}} -->
    <div class="tab-pane fade show product-tab">
        <div class="thread">
            <ul class="media-list thread-list" style="list-style: none; padding-bottom: 0;">
                <!-- <h4 class="tab-content-wrapper">Comments:</h4> -->
                <div *ngFor="let c of commentsList">
                    <li [id]="c?._id" *ngIf="c?.blockSpecificComment && c?.blockId === blockId" class="single-thread">
                        <app-comment [comment]="c" [referenceId]="cDetails?._id"></app-comment>
                    </li>
                </div>
            </ul>
        </div>
    </div>

    <div class="comment-form-area" style="padding-left: 0; padding-right: 0;">
        <!-- <app-add-comment [commentForm]="commentForm"></app-add-comment> -->

        <div class="media comment-form">
            <div class="media-left">
                <a href="#">
                    <img class="author_avatar_comment" style="width: 45px; height: 45px;"
                        [src]="authService?.loggedInUser?.avatar ? ((s3FilesBucketURL + authService?.loggedInUser?.avatar) | safe: 'resourceUrl') : anonymousAvatar"
                        alt="Commentator Avatar">
                </a>
            </div>
            <div class="media-body">
                <div [formGroup]="commentForm" class="comment-reply-form">
                    <app-editor #addCommentEditor
                        [editorStyle]="{padding: '0 15px', 'border-radius': '19px', background: '#f2f3f5', border: 'solid 0.5px rgb(236, 236, 236)'}"
                        [id]="blockId" [placeholder]="'Add Comment'">
                    </app-editor>

                    <button type="button" style="float: right;" class="btn btn--vsm btn--round"
                        (click)="addComment(blockId, addCommentEditor)">Post
                        Comment</button>
                </div>
            </div>
        </div>
    </div>
</ng-template>